---
import Image from "astro/components/Image.astro"
import logo from '../assets/logobetcraft.png';
---
<nav id="navbar" class="fixed z-10 flex items-center justify-between w-full px-6 py-2 border-b border-gray-100/50 transition-colors duration-300">
    <Image src={logo} alt="Logo" class="h-12 w-auto m-0 p-0 transition-colors duration-300" />
    
    <button id="openSidebarBtn" class="flex items-center text-white px-2 py-1 rounded-full font-semibold cursor-pointer transition-colors duration-300">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M3 18v-2h18v2zm0-5v-2h18v2zm0-5V6h18v2z"/></svg>
    </button>

    <!-- Sidebar dentro del nav -->
    <div id="sidebarOverlay" class="fixed inset-0 z-40 transition-colors duration-300 bg-black bg-opacity-0 pointer-events-none">
        <aside id="sidebar" class="bg-black h-full flex flex-col gap-5 p-2 w-full max-w-[350px] absolute top-0 left-0">
            <!-- Header usuario -->
            <div class="flex items-center justify-between px-6 py-2">
                <div class="flex gap-5 items-center">
                    <div>
                        <div class="text-white font-bold text-2xl">BETCRAFT</div>
                    </div>
                </div>
                <button id="closeSidebarBtn" class="text-white scale-125 cursor-pointer hover:ring hover:ring-white hover:bg-white hover:text-black rounded-full p-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M6.4 19L5 17.6l5.6-5.6L5 6.4L6.4 5l5.6 5.6L17.6 5L19 6.4L13.4 12l5.6 5.6l-1.4 1.4l-5.6-5.6z"/></svg>
                </button>
            </div>
            <!-- Links -->
            <div class="flex flex-col gap-2">
                <a href="#inicio" class="nav-link text-white bg-black flex items-center gap-2 hover:bg-white hover:text-black px-6 py-4 text-xl font-medium transition duration-250">
                    <div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M10 20v-6h4v6h5v-8h3L12 3L2 12h3v8z"/></svg>
                    </div>
                    Inicio
                </a>
                <a href="#sobre-nosotros" class="nav-link text-white bg-black flex items-center gap-2 hover:bg-white hover:text-black px-6 py-4 text-xl font-medium transition duration-250">
                    <div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M3 21V3h6.2q.35-.9 1.1-1.45T12 1t1.7.55T14.8 3H21v18zm9-16.75q.325 0 .538-.213t.212-.537t-.213-.537T12 2.75t-.537.213t-.213.537t.213.538t.537.212M12 13q1.45 0 2.475-1.025T15.5 9.5t-1.025-2.475T12 6T9.525 7.025T8.5 9.5t1.025 2.475T12 13m-7 6h14v-1.15q-1.35-1.325-3.137-2.087T12 15t-3.863.763T5 17.85z"/></svg>
                    </div>
                    Sobre Nosotros
                </a>
               <a href="#services" class="nav-link text-white bg-black flex items-center gap-2 hover:bg-white hover:text-black px-6 py-4 text-xl font-medium transition duration-250">
                    <div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="m8.8 10.95l2.15-2.175l-1.4-1.425l-1.1 1.1l-1.4-1.4l1.075-1.1L7 4.825L4.825 7zm8.2 8.225L19.175 17l-1.125-1.125l-1.1 1.075l-1.4-1.4l1.075-1.1l-1.425-1.4l-2.15 2.15zm-.775-12.75l1.4 1.4l1.4-1.4L17.6 5zM7.25 21H3v-4.25l4.375-4.375L2 7l5-5l5.4 5.4l3.775-3.8q.3-.3.675-.45t.775-.15t.775.15t.675.45L20.4 4.95q.3.3.45.675T21 6.4t-.15.763t-.45.662l-3.775 3.8L22 17l-5 5l-5.375-5.375z"/></svg>
                    </div>
                    Nuestros Servicios
                </a>
                <a href="#galeria" class="nav-link text-white bg-black flex items-center gap-2 hover:bg-white hover:text-black px-6 py-4 text-xl font-medium transition duration-250">
                    <div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M6 17h12l-3.75-5l-3 4L9 13zm-3 4V3h18v18zm5.5-11q.625 0 1.063-.437T10 8.5t-.437-1.062T8.5 7t-1.062.438T7 8.5t.438 1.063T8.5 10"/></svg>
                    </div>
                    Galería
                </a>
                <a href="#faq" class="nav-link text-white bg-black flex items-center gap-2 hover:bg-white hover:text-black px-6 py-4 text-xl font-medium transition duration-250">
                    <div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12 18q.525 0 .888-.363t.362-.887t-.363-.888T12 15.5t-.888.363t-.362.887t.363.888T12 18m-.9-3.85h1.85q0-.9.2-1.325T14 11.75q.875-.875 1.237-1.463T15.6 8.95q0-1.325-.9-2.137T12.275 6q-1.375 0-2.337.675T8.6 8.55l1.65.65q.175-.675.7-1.087t1.225-.413q.675 0 1.125.363t.45.962q0 .425-.275.9t-.925 1.05q-.825.725-1.138 1.388T11.1 14.15M3 21V3h18v18z"/></svg>
                    </div>
                    Preguntas Frecuentes
                </a>
                  <a href="#contacto" class="nav-link text-white bg-black flex items-center gap-2 hover:bg-white hover:text-black px-6 py-4 text-xl font-medium transition duration-250">
                    <div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M20 15.5c-1.25 0-2.45-.2-3.57-.57a1.02 1.02 0 0 0-1.02.24l-2.2 2.2a15.07 15.07 0 0 1-6.59-6.58l2.2-2.21c.28-.27.36-.66.25-1.01A11.4 11.4 0 0 1 8.5 4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1c0 9.39 7.61 17 17 17c.55 0 1-.45 1-1v-3.5c0-.55-.45-1-1-1M12 3v10l3-3h6V3z"/></svg>
                    </div>
                    Contáctanos
                </a>
            </div>
        </aside>
    </div>
</nav>

<script>
import { gsap } from 'gsap';

class Sidebar {
  private sidebar: HTMLElement;
  private overlay: HTMLElement;
  private openBtn: HTMLElement;
  private closeBtn: HTMLElement;
  private isOpen = false;
  private animation: gsap.core.Timeline;

  constructor() {
    this.sidebar = document.getElementById('sidebar')!;
    this.overlay = document.getElementById('sidebarOverlay')!;
    this.openBtn = document.getElementById('openSidebarBtn')!;
    this.closeBtn = document.getElementById('closeSidebarBtn')!;

    this.animation = gsap.timeline({ paused: true })
      .to(this.overlay, {
        opacity: 1,
        backgroundColor: 'rgba(0,0,0,0.5)',
        pointerEvents: 'auto',
        duration: 0.25,
        ease: 'none'
      })
      .to(this.sidebar, {
        x: '0%',
        duration: 0.3,
        ease: 'none'
      }, '<');

    this.prepareElements();
    this.initEventListeners();
  }

  private prepareElements(): void {
    gsap.set([this.sidebar, this.overlay], {
      willChange: 'transform, opacity'
    });
    gsap.set(this.sidebar, { x: '-100%' });
    gsap.set(this.overlay, {
      opacity: 0,
      pointerEvents: 'none',
      backgroundColor: 'rgba(0,0,0,0)'
    });
  }

  private initEventListeners(): void {
    this.openBtn.addEventListener('click', this.openSidebar);
    this.closeBtn.addEventListener('click', this.closeSidebar);
    this.overlay.addEventListener('click', this.closeSidebar);
    
    // Detener la propagación del evento en el sidebar
    this.sidebar.addEventListener('click', (e) => e.stopPropagation());
  }

  private openSidebar = (): void => {
    if (!this.isOpen) {
      this.isOpen = true;
      this.animation.restart();
    }
  }

  private closeSidebar = (): void => {
    if (this.isOpen) {
      // Animación de cierre (inversa de la apertura)
      gsap.to(this.sidebar, {
        x: '-100%',
        duration: 0.3,
        ease: 'none'
      });
      gsap.to(this.overlay, {
        opacity: 0,
        backgroundColor: 'rgba(0,0,0,0)',
        pointerEvents: 'none',
        duration: 0.25,
        ease: 'none',
        onComplete: () => {
          this.isOpen = false;
        }
      });
    }
  }
}

document.addEventListener('DOMContentLoaded', () => {
  const sidebar = new Sidebar();
  
  // Nuevo código para manejar el scroll con efectos suaves
  const navbar = document.getElementById('navbar');
  const logo = navbar.querySelector('img');
  const menuButton = document.getElementById('openSidebarBtn');
  const menuIcon = menuButton.querySelector('svg path');
  
  // Manejar clics en los enlaces del sidebar
  document.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      const targetId = link.getAttribute('href');
      const targetElement = document.querySelector(targetId);
      
      if (targetElement) {
        // Cerrar el sidebar
        sidebar.closeSidebar();
        
        // Desplazamiento suave a la sección
        targetElement.scrollIntoView({
          behavior: 'smooth'
        });
      }
    });
  });
  
  function updateNavbar() {
    const scrollPosition = window.scrollY;
    const opacity = Math.min(scrollPosition / 200, 1); // Ajusta 200 para cambiar la velocidad de transición
    
    // Fondo con transición suave
    navbar.style.backgroundColor = `rgba(255, 255, 255, ${opacity})`;
    
    // Cambio de colores según el fondo
    if (opacity > 0.5) {
      // Fondo claro (más de 50% opaco)
      logo.style.filter = 'none';
      menuButton.classList.remove('text-white');
      menuButton.classList.add('text-[#352a26]');
      menuIcon.setAttribute('fill', '#352a26');
    } else {
      // Fondo oscuro/transparente
      logo.style.filter = 'brightness(0) invert(1)';
      menuButton.classList.remove('text-[#352a26]');
      menuButton.classList.add('text-white');
      menuIcon.setAttribute('fill', 'white');
    }
  }
  
  // Ejecutar al cargar y al hacer scroll
  updateNavbar();
  window.addEventListener('scroll', updateNavbar);
});
</script>